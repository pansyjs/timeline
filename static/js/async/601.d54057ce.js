"use strict";(self.webpackChunk_pansy_react_timeline=self.webpackChunk_pansy_react_timeline||[]).push([["601"],{2220:function(e,t,r){r.r(t),r.d(t,{default:()=>D});var l=r(2676),n=r(5271),i=r(4461),a=r(1031),o=r(8605),s=r(4875),d=r.n(s),u=r(6483),m=r.n(u);let c="pansy",f=[{scale:"minute",step:1,labelStep:10,majorLabelFormat:"YYYY-MM-DD",minorLabelFormat:"HH:mm:ss"},{scale:"minute",step:5,labelStep:10,majorLabelFormat:"YYYY-MM-DD",minorLabelFormat:"HH:mm:ss"},{scale:"minute",step:10,labelStep:10,majorLabelFormat:"YYYY-MM-DD",minorLabelFormat:"HH:mm:ss"},{scale:"minute",step:30,labelStep:10,majorLabelFormat:"YYYY-MM-DD",minorLabelFormat:"HH:mm:ss"},{scale:"hour",step:1,labelStep:5,majorLabelFormat:"YYYY-MM-DD",minorLabelFormat:"HH:mm"},{scale:"hour",step:6,labelStep:5,majorLabelFormat:"YYYY-MM-DD",minorLabelFormat:"HH:mm"},{scale:"hour",step:12,labelStep:5,majorLabelFormat:"YYYY-MM-DD",minorLabelFormat:"HH:mm"},{scale:"day",step:1,labelStep:1,majorLabelFormat:"YYYY-MM",minorLabelFormat:"DD"}],h={paddingStart:48,paddingEnd:48,width:1},v="YYYY-MM-DD HH:mm:ss",g="#2B6DE5",p={cardFirstRowMargin:24,cardRowGap:16};function b(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c;return e?`${t}-${e}`:t}let x=n.createContext({prefixCls:c,defaultColor:g,getPrefixCls:b});r(5411);let y=n.forwardRef(function(e,t){let{className:r,style:a,hover:o,data:s,checked:d,position:u=24,render:c,...f}=e,{getPrefixCls:h,defaultColor:g}=n.useContext(x),p=h("timeline-card"),{color:b=g,customRender:y=!0,time:M}=s,k=(!M?[]:Array.isArray(M)?M:[M]).reduce((e,t)=>{let r=m()(t).format(v);return e?e+" ~ "+r:e+r},""),Y=n.useMemo(()=>y&&c?c({...s,color:b}):(0,l.jsxs)("div",{className:`${p}-cntent`,style:{borderColor:b},children:[(0,l.jsx)("div",{className:`${p}-title`,children:null==s?void 0:s.title}),(0,l.jsx)("div",{className:`${p}-time`,children:k})]}),[s,b,y,c]);return(0,l.jsxs)("div",{className:(0,i.W)(p,r),style:{...a,top:u},ref:t,...f,children:[(0,l.jsx)("div",{className:`${p}-line`,style:{backgroundColor:o||d?b:void 0,top:-u,height:u}}),(0,l.jsx)("div",{className:`${p}-container`,style:{zIndex:d?50:10},children:Y})]})});y.displayName="TimeCard";var M=r(9108);let k=(0,r(7977).Z)();function Y(e){let{timeRange:t,children:r}=e,[a,o]=n.useState(0),{getPrefixCls:s,rootElement:d}=n.useContext(x),u=s("timeline-axis"),c=n.useCallback(()=>{let e=[];if(!t)return e;let{step:r,scale:l}=f[a];for(let n=t.start;n.isBefore(t.end);n=n.add(r,l))e.push({time:n});return e},[t])(),v=(0,M.MG)({horizontal:!0,count:c.length,getScrollElement:()=>d,estimateSize:()=>1,gap:8,paddingStart:h.paddingStart,paddingEnd:h.paddingEnd}),g=e=>{v.scrollToOffset(v.scrollOffset+e.dx)};return n.useEffect(()=>(k.on("panmove",g),()=>{k.off("panmove",g)}),[]),(0,l.jsxs)("div",{className:u,style:{width:`${v.getTotalSize()}px`},children:[v.getVirtualItems().map(e=>{let{index:t,key:r}=e,{time:n}=c[t],{labelStep:o,majorLabelFormat:s,minorLabelFormat:d}=f[a],h=m()(n).format(s),g=m()(n).format(d),p=t%o==0;return(0,l.jsx)("div",{className:(0,i.W)(`${u}-tick`,{[`${u}-tick-major`]:p,[`${u}-tick-big-major`]:0===t}),"data-index":t,ref:v.measureElement,style:{transform:`translateX(${e.start}px)`},children:p&&(0,l.jsx)("div",{className:`${u}-tick-lable`,children:0===t?h:g})},r)}),r]})}r(7045);let C=(0,r(4706).H)(function(e){let{color:t,opacity:r=.3}=e;if(!t)return;if("number"!=typeof r||r<0||r>1)throw Error("透明度必须是0到1之间的数字");let l=document.createElement("div");l.style.display="none",l.style.color=t,document.body.appendChild(l);let n=getComputedStyle(l).color;document.body.removeChild(l);let i=n.match(/^rgb(a)?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/);if(i){let[,,e,t,l]=i;return`rgba(${e}, ${t}, ${l}, ${r})`}},{getCacheKey:e=>e.color+e.opacity});function j(e){let{className:t,style:r,data:a,checked:o,hover:s,...d}=e,{getPrefixCls:u,defaultColor:c}=n.useContext(x),f=u("timeline-point"),{time:h,color:g=c}=a;return Array.isArray(h)&&2===h.length?(0,l.jsxs)("div",{className:(0,i.W)(f,`${f}-range`,t),style:{...r,backgroundColor:s||o?C({color:g}):void 0},...d,children:[(0,l.jsx)("div",{className:`${f}-dot`,title:m()(h[0]).format(v),style:{backgroundColor:s||o?g:void 0}}),(0,l.jsx)("div",{className:`${f}-dot`,title:m()(h[1]).format(v),style:{backgroundColor:s||o?g:void 0}})]}):(0,l.jsx)("div",{className:(0,i.W)(f,`${f}-dot`,t),style:{...r,backgroundColor:s||o?g:void 0},title:m()(h).format(v)})}r(8955);let w=e=>Array.isArray(e)&&2===e.length;function S(e){let{start:t,end:r}=e,l=0===m()(r).minute()&&0===m()(r).second()&&0===m()(r).millisecond();return{start:m()(t).startOf("hour"),end:l?m()(r):m()(r).add(1,"hour").startOf("hour")}}let L=e=>{let{offsetWidth:t,offsetHeight:r}=e;return{width:t,height:r}},R=(e,t)=>{let r=e=>{let{width:t,height:r}=e;return{width:Math.round(t),height:Math.round(r)}};if(null==t?void 0:t.borderBoxSize){let e=t.borderBoxSize[0];if(e)return r({width:e.inlineSize,height:e.blockSize})}return r(L(e))};function $(e){let{className:t,style:r,data:s=[],moveable:u=!0,defaultColor:f=g,renderCard:v,onSelect:M}=e,C=e.prefixCls||c,$=n.useRef(null),E=n.useRef(null),[D]=n.useState(()=>new Map),[F]=n.useState(()=>new Map),H=n.useReducer(()=>({}),{})[1],[A,N]=n.useState(!1),[O,z]=n.useState(null),[W,_]=n.useState(null),[T,B]=n.useState(),G=n.useCallback(e=>b(e,C),[C]),I=G("timeline");function X(e){e.preventDefault()}n.useEffect(()=>{let e=$.current;if(!e)return;d()(e).styleCursor(!1).draggable({lockAxis:"x",inertia:!0,listeners:{start(e){u&&k.emit("panstart",e)},move(e){u&&k.emit("panmove",e)},end(e){u&&k.emit("panend",e)}}}).on("mousedown",function(){N(!0)}).on("mouseup",function(){N(!1)});let t="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";return e.addEventListener(t,X,!1),()=>{d()(e).unset(),e.removeEventListener(t,X,!1)}},[]),n.useEffect(()=>{B(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{padding:r=30,minRange:l=1440,defaultCenter:n=m()()}=t,i=m()(n),a={start:i.subtract(l/2,"minute"),end:i.add(l/2,"minute")};if(!e||0===e.length)return S(a);let o=e.flatMap(e=>w(e.time)?[m()(e.time[0]),m()(e.time[1])]:[m()(e.time)]);if(1===o.length){let e=m()(o[0]);return S({start:e.subtract(l/2,"minute"),end:e.add(l/2,"minute")})}let s=m()(Math.min(...o.map(e=>e.valueOf()))),d=m()(Math.max(...o.map(e=>e.valueOf()))),u=s.subtract(r,"minute"),c=d.add(r,"minute"),f=c.diff(u,"minute");if(f<l){let e=(l-f)/2;return S({start:u.subtract(e,"minute"),end:c.add(e,"minute")})}return S({start:u,end:c})}(s,{padding:30,minRange:1440,defaultCenter:new Date}))},[s]);let P=e=>{z(e)},q=e=>{if((null==W?void 0:W.id)===e.id){_(null),null==M||M(null);return}_(e),null==M||M(e)},K=(()=>{let e=null,t=()=>e||(window.ResizeObserver?e=new window.ResizeObserver(e=>{e.forEach(e=>{requestAnimationFrame(()=>{V(e.target,e)})})}):null);return{disconnect:()=>{var r;null==(r=t())||r.disconnect(),e=null},observe:e=>{var r;return null==(r=t())?void 0:r.observe(e,{box:"border-box"})},unobserve:e=>{var r;return null==(r=t())?void 0:r.unobserve(e)}}})(),V=(e,t)=>{let r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"data-key";return e.getAttribute(t)||""}(e),l=D.get(r);if(l!==e&&(l&&K.unobserve(l),K.observe(e),D.set(r,e)),e.isConnected){let l=R(e,t),i=e.getClientRects()[0],s=F.get(r),d={...l,key:r,x:i.x,y:p.cardFirstRowMargin};if(!s){F.set(r,d),J();return}if(!(0,a.X)((0,o.C)(d,["y"]),(0,o.C)(s,["y"]))){var n;F.set(r,{...d,y:(null==(n=F.get(r))?void 0:n.y)||p.cardFirstRowMargin})}}},Z=n.useCallback(e=>{if(!e)return void D.forEach((e,t)=>{e.isConnected||(K.unobserve(e),D.delete(t))});V(e,void 0)},[]),J=()=>{let e=E.current;if(!e)return;let t=L(e).height;if(t<=p.cardFirstRowMargin)return;let r=function(e){if(e.length<2)return[];let t=[...e].sort((e,t)=>e.x-t.x),r=[];for(let e of t){let t=e.x+e.width,l=[];for(let n of r)e.x<n.maxRight&&t>n.minLeft&&l.push(n);if(l.length>0){let n=l[0];n.items.push(e),n.minLeft=Math.min(n.minLeft,e.x),n.maxRight=Math.max(n.maxRight,t);for(let e=1;e<l.length;e++){let t=l[e];n.items.push(...t.items),n.minLeft=Math.min(n.minLeft,t.minLeft),n.maxRight=Math.max(n.maxRight,t.maxRight);let i=r.indexOf(t);-1!==i&&r.splice(i,1)}}else r.push({items:[e],minLeft:e.x,maxRight:t})}return r.map(e=>e.items).filter(e=>e.length>=2)}(Array.from(F.values()));console.log(r),r.forEach(e=>{let{cardFirstRowMargin:r,cardRowGap:l}=p,n=r,i=1;e.forEach(e=>{if(1===i){let a=n+e.height+l;a<=t?(F.set(e.key,{...F.get(e.key),y:n}),n=a):(i=-1,n=t-r-e.height,F.set(e.key,{...F.get(e.key),y:n}))}else{let t=n-e.height-l;t>=r?n=t:(i=1,n=r),F.set(e.key,{...F.get(e.key),y:n})}})}),H()};return(0,l.jsx)("div",{className:(0,i.W)(I,t),ref:$,style:{cursor:A?"grabbing":"grab",...r},children:(0,l.jsxs)(x.Provider,{value:{prefixCls:I,getPrefixCls:G,defaultColor:f,rootElement:$.current},children:[(0,l.jsx)(Y,{timeRange:T}),(0,l.jsx)("div",{className:`${I}-content`,ref:E,children:T&&s.map((e,t)=>{var r;let i,{time:a,id:o}=e,s=(null==(r=F.get(e.id))?void 0:r.y)||20,d=function(e){let{targetTime:t,baseTime:r,tickIntervalMs:l,tickWidth:n,tickGap:i,paddingStart:a,potSize:o}=e,s=m()(t).valueOf();return(s-m()(r).valueOf())/l*(n+i)+a-o/2}({targetTime:Array.isArray(a)?a[0]:a,baseTime:T.start,tickIntervalMs:6e4,tickWidth:h.width,tickGap:8,paddingStart:h.paddingStart,potSize:8});return Array.isArray(a)&&2===a.length&&(i=function(e){let{timeRange:t,tickIntervalMs:r,tickWidth:l,tickGap:n}=e,i=m()(t.start).valueOf();return(m()(t.end).valueOf()-i)/r*(l+n)+n}({timeRange:{start:a[0],end:a[1]},tickIntervalMs:6e4,tickWidth:h.width,tickGap:8})),(0,l.jsxs)(n.Fragment,{children:[(0,l.jsx)(j,{style:{transform:`translateX(${d}px)`,width:i?`${i}px`:void 0},data:e,hover:e.id===(null==O?void 0:O.id),checked:e.id===(null==W?void 0:W.id),onMouseEnter:()=>{P(e)},onMouseLeave:()=>{P(null)},onClick:()=>{q(e)}}),(0,l.jsx)(y,{style:{left:d+4},position:s,ref:Z,"data-key":e.id,hover:e.id===(null==O?void 0:O.id),checked:e.id===(null==W?void 0:W.id),data:e,onMouseEnter:()=>{P(e)},onMouseLeave:()=>{P(null)},onClick:()=>{q(e)},render:v})]},o||t)})})]})})}r(5924);let E=[{id:"1",title:"单点事件",color:"#A140E7",customRender:!1,time:"2024-03-10 10:00:00"},{id:"1111",title:"单点事件",time:"2024-03-10 10:01:00"},{id:"2",title:"时间范围事件",color:"#A140E7",customRender:!1,time:["2024-03-10 11:30:00","2024-03-10 13:30:00"]},{id:"3",title:"单点事件",customRender:!1,time:"2024-03-10 16:00:00"},{id:"4",title:"长时间范围事件",customRender:!1,time:["2024-03-10 14:15:00","2024-03-10 18:15:00"]},{id:"5",title:"长时间范围事件",customRender:!1,time:["2024-03-10 19:15:00","2024-03-10 23:15:00"]}],D=function(){return(0,l.jsx)($,{data:E,renderCard:e=>(0,l.jsx)("div",{style:{background:"#fff",width:180,height:100,borderLeft:`3px solid ${e.color}`},children:e.title})})}}}]);