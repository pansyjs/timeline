"use strict";(self.webpackChunk_pansy_react_timeline=self.webpackChunk_pansy_react_timeline||[]).push([["893"],{4367:function(e,t,i){i.r(t),i.d(t,{default:()=>L});var r=i(2676),n=i(9108),l=i(4461),a=i(6483),s=i.n(a),o=i(4875),d=i.n(o),u=i(5271);let m="pansy",c={day:864e5,hour:36e5,minute:6e3},h=[{scale:"minute",step:1,labelStep:10,tickGap:8,majorLabelFormat:"YYYY-MM-DD",minorLabelFormat:"HH:mm:ss"},{scale:"minute",step:5,labelStep:10,tickGap:8,majorLabelFormat:"YYYY-MM-DD",minorLabelFormat:"HH:mm:ss"},{scale:"minute",step:10,labelStep:10,tickGap:8,majorLabelFormat:"YYYY-MM-DD",minorLabelFormat:"HH:mm:ss"},{scale:"minute",step:30,labelStep:10,tickGap:8,majorLabelFormat:"YYYY-MM-DD",minorLabelFormat:"HH:mm:ss"},{scale:"hour",step:1,labelStep:5,tickGap:8,majorLabelFormat:"YYYY-MM-DD",minorLabelFormat:"HH:mm"},{scale:"hour",step:6,labelStep:5,tickGap:8,majorLabelFormat:"YYYY-MM-DD",minorLabelFormat:"HH:mm"},{scale:"hour",step:12,labelStep:5,tickGap:8,majorLabelFormat:"YYYY-MM-DD",minorLabelFormat:"HH:mm"},{scale:"day",step:1,labelStep:2,tickGap:16,majorLabelFormat:"YYYY-MM",minorLabelFormat:"DD"}],f="YYYY-MM-DD HH:mm:ss",v="#2B6DE5",g={cardFirstRowMargin:24,cardRowGap:16,axisPaddingStart:48,axisPaddingEnd:48,axisTickWidth:1,pointSize:8};function p(e){return{width:e.offsetWidth,height:e.offsetHeight}}let b="undefined"!=typeof document?u.useLayoutEffect:u.useEffect;var x=i(833),y=i(1031),k=i(8605);class w{constructor(e){(0,x._)(this,"options",void 0),(0,x._)(this,"containerElement",null),(0,x._)(this,"targetWindow",null),(0,x._)(this,"itemRectCache",new Map),(0,x._)(this,"elementsCache",new Map),(0,x._)(this,"observer",(()=>{let e=null,t=()=>e||(this.targetWindow&&this.targetWindow.ResizeObserver?e=new this.targetWindow.ResizeObserver(e=>{e.forEach(e=>{let t=()=>{this._measureElement(e.target,e)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(t):t()})}):null);return{disconnect:()=>{var i;null==(i=t())||i.disconnect(),e=null},observe:e=>{var i;return null==(i=t())?void 0:i.observe(e,{box:"border-box"})},unobserve:e=>{var i;return null==(i=t())?void 0:i.unobserve(e)}}})()),(0,x._)(this,"setOptions",e=>{Object.entries(e).forEach(t=>{let[i,r]=t;void 0===r&&delete e[i]}),this.options=Object.assign({useAnimationFrameWithResizeObserver:!0,keyAttribute:"data-key"},e)}),(0,x._)(this,"cleanup",()=>{this.observer.disconnect(),this.containerElement=null,this.targetWindow=null}),(0,x._)(this,"notify",()=>{var e,t;null==(e=(t=this.options).onChange)||e.call(t,this)}),(0,x._)(this,"_didMount",()=>()=>{this.cleanup()}),(0,x._)(this,"_willUpdate",()=>{let e=this.options.getContainerElement();if(this.containerElement!==e){if(this.cleanup(),!e)return;if(this.containerElement=e,this.containerElement&&"ownerDocument"in this.containerElement)this.targetWindow=this.containerElement.ownerDocument.defaultView;else{var t;this.targetWindow=(null==(t=this.scrollElement)?void 0:t.window)??null}this.elementsCache.forEach(e=>{this.observer.observe(e)})}}),(0,x._)(this,"keyFromElement",e=>{let t=this.options.keyAttribute,i=e.getAttribute(t);return i||(console.warn(`Missing attribute name '${t}={key}' on measured element.`),"")}),(0,x._)(this,"_measureElement",(e,t)=>{let i=this.keyFromElement(e),r=this.elementsCache.get(i);if(r!==e&&(r&&this.observer.unobserve(r),this.observer.observe(e),this.elementsCache.set(i,e)),e.isConnected){let r=function(e,t){let i=e=>{let{width:t,height:i}=e;return{width:Math.round(t),height:Math.round(i)}};if(null==t?void 0:t.borderBoxSize){let e=t.borderBoxSize[0];if(e)return i({width:e.inlineSize,height:e.blockSize})}return i(p(e))}(e,t),n=e.getClientRects()[0],l=this.itemRectCache.get(i),a={...r,key:i,x:n.x,y:g.cardFirstRowMargin};if(!l){this.itemRectCache.set(i,a),this.notify();return}(0,y.X)((0,k.C)(a,["y"]),(0,k.C)(l,["y"]))||(this.itemRectCache.set(i,{...a,y:(null==l?void 0:l.y)||g.cardFirstRowMargin}),this.notify())}}),(0,x._)(this,"measureElement",e=>{if(!e)return void this.elementsCache.forEach((e,t)=>{e.isConnected||(this.observer.unobserve(e),this.elementsCache.delete(t))});this._measureElement(e,void 0)}),this.setOptions(e)}}function C(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m;return e?`${t}-${e}`:t}let M=u.createContext({prefixCls:m,getPrefixCls:C});i(5411);let E=u.forwardRef(function(e,t){let{className:i,style:n,hover:a,data:o,defaultColor:d=v,checked:m,position:c=24,render:h,...g}=e,{getPrefixCls:p}=u.useContext(M),b=p("timeline-card"),{color:x=d,customRender:y=!0,time:k}=o,w=(!k?[]:Array.isArray(k)?k:[k]).reduce((e,t)=>{let i=s()(t).format(f);return e?`${e} ~ ${i}`:e+i},""),C=u.useMemo(()=>y&&h?h({...o,color:x}):(0,r.jsxs)("div",{className:`${b}-cntent`,style:{borderColor:x},children:[(0,r.jsx)("div",{className:`${b}-title`,children:null==o?void 0:o.title}),(0,r.jsx)("div",{className:`${b}-time`,children:w})]}),[o,x,y,h]);return(0,r.jsxs)("div",{className:(0,l.W)(b,i),style:{...n,top:c},ref:t,...g,children:[(0,r.jsx)("div",{className:`${b}-line`,style:{backgroundColor:a||m?x:void 0,top:-c,height:c}}),(0,r.jsx)("div",{className:`${b}-container`,style:{zIndex:m?50:10},children:C})]})});E.displayName="TimeCard";let Y=(0,i(4706).H)(function(e){let{color:t,opacity:i=.3}=e;if(!t)return;if("number"!=typeof i||i<0||i>1)throw Error("透明度必须是0到1之间的数字");let r=document.createElement("div");r.style.display="none",r.style.color=t,document.body.appendChild(r);let n=getComputedStyle(r).color;document.body.removeChild(r);let l=n.match(/^rgb(a)?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/);if(l){let[,,e,t,r]=l;return`rgba(${e}, ${t}, ${r}, ${i})`}},{getCacheKey:e=>e.color+e.opacity});function R(e){let{className:t,style:i,data:n,checked:a,defaultColor:o=v,hover:d,...m}=e,{getPrefixCls:c}=u.useContext(M),h=c("timeline-point"),{time:g,color:p=o}=n;return Array.isArray(g)&&2===g.length?(0,r.jsxs)("div",{className:(0,l.W)(h,`${h}-range`,t),style:{...i,zIndex:a?50:10,backgroundColor:d||a?Y({color:p}):void 0},...m,children:[(0,r.jsx)("div",{className:`${h}-dot`,title:s()(g[0]).format(f),style:{backgroundColor:d||a?p:void 0}}),(0,r.jsx)("div",{className:`${h}-dot`,title:s()(g[1]).format(f),style:{backgroundColor:d||a?p:void 0}})]}):(0,r.jsx)("div",{className:(0,l.W)(h,`${h}-dot`,t),style:{...i,zIndex:a?50:10,backgroundColor:d||a?p:void 0},title:s()(g).format(f)})}i(8955),i(5924);let S=[];function j(e){let{className:t,style:i,data:a=S,moveable:o=!0,zoomable:x=!0,defaultColor:y=v,renderCard:k,onSelect:Y}=e,j=e.prefixCls||m,$=u.useRef(null),L=u.useRef(null),F=u.useRef(null),[O,_]=u.useState(!1),[D,z]=u.useState(null),[A,W]=u.useState(null),{onZoom:H,ticks:G,timeRange:N,granularity:T}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{data:t,getContainerElement:i}=e,[r,n]=u.useState(7),[l,a]=u.useState(0);u.useEffect(()=>{let e=i();if(e)return function(e,t){if(!e)return;let i=null;if(!(i=e&&"ownerDocument"in e?e.ownerDocument.defaultView:(null==e?void 0:e.window)??null))return;let r=e=>{let{width:i,height:r}=e;t({width:Math.round(i),height:Math.round(r)})};if(!i.ResizeObserver)return()=>{};let n=new i.ResizeObserver(t=>{requestAnimationFrame(()=>{let i=t[0];if(null==i?void 0:i.borderBoxSize){let e=i.borderBoxSize[0];if(e)return void r({width:e.inlineSize,height:e.blockSize})}r(p(e))})});return n.observe(e,{box:"border-box"}),()=>{n.unobserve(e)}}(e,e=>{a(e.width)})},[]);let o=u.useMemo(()=>h[r]||h["0"],[r]),d=u.useMemo(()=>{if(!l)return null;let e=h[h.length-1],i=Math.round(l/e.tickGap+g.axisTickWidth)*e.step*c[e.scale],r=t.flatMap(e=>{var t;return Array.isArray(t=e.time)&&2===t.length?[s()(e.time[0]),s()(e.time[1])]:[s()(e.time)]}).sort((e,t)=>e.valueOf()-t.valueOf()),n=r.length?r[0]:s()(),a=r.length?r[r.length-1]:s()(),o=a.valueOf()-n.valueOf();return o>i?{start:n.subtract(30,"day").startOf("day"),end:a.add(30,"day").startOf("day")}:{start:n.subtract(i-o,"millisecond").subtract(30,"day").startOf("day"),end:a.add(30,"day").startOf("day")}},[l,t]);return{ticks:u.useMemo(()=>{let e=[];if(!d)return e;let{step:t,scale:i}=o;for(let r=d.start;r.isBefore(d.end);r=r.add(t,i))e.push({time:r});return e},[d,o]),granularity:o,timeRange:d,onZoom:e=>{e>0?n(e=>e>=h.length-1?e:e+1):n(e=>e<=0?0:e-1)}}}({data:a,getContainerElement:()=>$.current}),P=u.useCallback(e=>C(e,j),[j]),B=P("timeline"),I=e=>{let t=e.itemRectCache,i=F.current;if(!i)return;let r=p(i).height;r<=g.cardFirstRowMargin||(function(e){if(e.length<2)return[];let t=[...e].sort((e,t)=>e.x-t.x),i=[];for(let e of t){let t=e.x+e.width,r=[];for(let n of i)e.x<n.maxRight&&t>n.minLeft&&r.push(n);if(r.length>0){let n=r[0];n.items.push(e),n.minLeft=Math.min(n.minLeft,e.x),n.maxRight=Math.max(n.maxRight,t);for(let e=1;e<r.length;e++){let t=r[e];n.items.push(...t.items),n.minLeft=Math.min(n.minLeft,t.minLeft),n.maxRight=Math.max(n.maxRight,t.maxRight);let l=i.indexOf(t);-1!==l&&i.splice(l,1)}}else i.push({items:[e],minLeft:e.x,maxRight:t})}return i.map(e=>e.items).filter(e=>e.length>=2)})(Array.from(t.values())).forEach(e=>{let{cardFirstRowMargin:i,cardRowGap:n}=g,l=i,a=1;e.forEach(e=>{if(1===a){let s=l+e.height+n;s<=r?(t.set(e.key,{...t.get(e.key),y:l}),l=s):(a=-1,l=r-i-e.height,t.set(e.key,{...t.get(e.key),y:l}))}else{let r=l-e.height-n;r>=i?l=r:(a=1,l=i),t.set(e.key,{...t.get(e.key),y:l})}})})},q=function(e){let t=u.useReducer(()=>({}),{})[1],i={...e,onChange:i=>{var r;t(),null==(r=e.onChange)||r.call(e,i)}},[r]=u.useState(()=>new w(i));return r.setOptions(i),b(()=>r._didMount(),[]),b(()=>r._willUpdate()),r}({getContainerElement:()=>F.current,onChange:e=>{requestAnimationFrame(()=>{I(e)})}}),V=(0,n.MG)({horizontal:!0,count:G.length,getScrollElement:()=>$.current,estimateSize:()=>1,gap:T.tickGap,paddingStart:g.axisPaddingStart,paddingEnd:g.axisPaddingEnd});function X(e){e.preventDefault(),x&&H(e.deltaY)}u.useEffect(()=>{let e=$.current;if(e)return d()(e).styleCursor(!1).draggable({lockAxis:"x",inertia:!0,listeners:{move(e){o&&V.scrollToOffset(V.scrollOffset+e.dx)}}}).on("mousedown",()=>{_(!0)}).on("mouseup",()=>{_(!1)}),()=>{d()(e).unset()}},[]),u.useEffect(()=>{let e=L.current;if(!e)return;let t="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";return e.addEventListener(t,X,!1),()=>{e.removeEventListener(t,X,!1)}},[]);let U=e=>{z(e)},K=e=>{if((null==A?void 0:A.id)===e.id){W(null),null==Y||Y(null);return}W(e),null==Y||Y(e)},Z=u.useMemo(()=>({prefixCls:B,getPrefixCls:P}),[B,P]);return(0,r.jsx)("div",{className:(0,l.W)(B,t),ref:$,style:{cursor:O?"grabbing":"grab",...i},children:(0,r.jsxs)(M.Provider,{value:Z,children:[(0,r.jsx)("div",{className:`${B}-axis`,ref:L,style:{width:`${V.getTotalSize()}px`},children:V.getVirtualItems().map(e=>{let{index:t,key:i}=e,{time:n}=G[t],{labelStep:a,majorLabelFormat:o,minorLabelFormat:d}=T,u=s()(n).format(o),m=s()(n).format(d),c=t%a==0;return(0,r.jsx)("div",{className:(0,l.W)(`${B}-axis-tick`,{[`${B}-axis-tick-major`]:c,[`${B}-axis-tick-big-major`]:0===t}),"data-index":t,"data-time":n.format(f),ref:V.measureElement,style:{transform:`translateX(${e.start}px)`},children:c&&(0,r.jsx)("div",{className:`${B}-axis-tick-lable`,children:0===t?u:m})},i)})}),(0,r.jsx)("div",{className:`${B}-content`,ref:F,children:N&&a.map((e,t)=>{var i;let n,{time:l,id:a}=e,o=(null==(i=q.itemRectCache.get(e.id))?void 0:i.y)||20,d=T.step*c[T.scale],m=function(e){let{targetTime:t,baseTime:i,tickIntervalMs:r,tickWidth:n,tickGap:l,paddingStart:a,pointSize:o}=e,d=s()(t).valueOf();return(d-s()(i).valueOf())/r*(n+l)+a-o/2}({targetTime:Array.isArray(l)?l[0]:l,baseTime:N.start,tickIntervalMs:d,tickWidth:g.axisTickWidth,tickGap:T.tickGap,paddingStart:g.axisPaddingEnd,pointSize:g.pointSize});return Array.isArray(l)&&2===l.length&&(n=function(e){let{timeRange:t,tickIntervalMs:i,tickWidth:r,tickGap:n}=e,l=s()(t.start).valueOf();return(s()(t.end).valueOf()-l)/i*(r+n)+n}({timeRange:{start:l[0],end:l[1]},tickIntervalMs:d,tickWidth:g.axisTickWidth,tickGap:T.tickGap})),(0,r.jsxs)(u.Fragment,{children:[(0,r.jsx)(R,{style:{transform:`translateX(${m}px)`,width:n?`${n}px`:void 0},data:e,hover:e.id===(null==D?void 0:D.id),checked:e.id===(null==A?void 0:A.id),onMouseEnter:()=>{U(e)},onMouseLeave:()=>{U(null)},onClick:()=>{K(e)}}),(0,r.jsx)(E,{style:{left:m+4},position:o,ref:q.measureElement,"data-key":e.id,hover:e.id===(null==D?void 0:D.id),checked:e.id===(null==A?void 0:A.id),data:e,defaultColor:y,onMouseEnter:()=>{U(e)},onMouseLeave:()=>{U(null)},onClick:()=>{K(e)},render:k})]},a||t)})})]})})}let $=[{id:"1",title:"单点事件",color:"#A140E7",customRender:!1,time:"2024-03-10 10:00:00"},{id:"1111",title:"单点事件",time:"2024-03-10 10:01:00"},{id:"2",title:"时间范围事件",color:"#A140E7",customRender:!1,time:["2024-03-10 11:30:00","2024-03-10 13:30:00"]},{id:"3",title:"单点事件",customRender:!1,time:"2024-03-10 16:00:00"},{id:"4",title:"长时间范围事件",customRender:!1,time:["2024-03-10 14:15:00","2024-03-10 18:15:00"]},{id:"5",title:"长时间范围事件",customRender:!1,time:["2024-03-10 19:15:00","2024-03-10 23:15:00"]}],L=function(){return(0,r.jsx)(j,{data:$,renderCard:e=>(0,r.jsx)("div",{style:{background:"#fff",width:180,height:100,borderLeft:`3px solid ${e.color}`},children:e.title})})}}}]);