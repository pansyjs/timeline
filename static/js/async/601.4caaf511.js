"use strict";(self.webpackChunk_pansy_react_timeline=self.webpackChunk_pansy_react_timeline||[]).push([["601"],{2220:function(e,t,r){r.r(t),r.d(t,{default:()=>A});var n=r(2676),a=r(5271),l=r(6483),i=r.n(l),o=r(4461),s=r(1031),d=r(8605),u=r(4875),m=r.n(u);let c="pansy",f=[{scale:"minute",step:1,labelStep:10,majorLabelFormat:"YYYY-MM-DD",minorLabelFormat:"HH:mm:ss"},{scale:"minute",step:5,labelStep:10,majorLabelFormat:"YYYY-MM-DD",minorLabelFormat:"HH:mm:ss"},{scale:"minute",step:10,labelStep:10,majorLabelFormat:"YYYY-MM-DD",minorLabelFormat:"HH:mm:ss"},{scale:"minute",step:30,labelStep:10,majorLabelFormat:"YYYY-MM-DD",minorLabelFormat:"HH:mm:ss"},{scale:"hour",step:1,labelStep:5,majorLabelFormat:"YYYY-MM-DD",minorLabelFormat:"HH:mm"},{scale:"hour",step:6,labelStep:5,majorLabelFormat:"YYYY-MM-DD",minorLabelFormat:"HH:mm"},{scale:"hour",step:12,labelStep:5,majorLabelFormat:"YYYY-MM-DD",minorLabelFormat:"HH:mm"},{scale:"day",step:1,labelStep:1,majorLabelFormat:"YYYY-MM",minorLabelFormat:"DD"}],h={paddingStart:48,paddingEnd:48,width:1},p="YYYY-MM-DD HH:mm:ss",v="#2B6DE5",b={cardInitialGap:24,cardGap:16};function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c;return e?`${t}-${e}`:t}let y=a.createContext({prefixCls:c,defaultColor:v,getPrefixCls:g});r(5411);let x=a.forwardRef(function(e,t){let{className:r,style:l,hover:s,data:d,checked:u,position:m=24,render:c,...f}=e,{getPrefixCls:h,defaultColor:v}=a.useContext(y),b=h("timeline-card"),{color:g=v,customRender:x=!0,time:k}=d,M=(!k?[]:Array.isArray(k)?k:[k]).reduce((e,t)=>{let r=i()(t).format(p);return e?e+" ~ "+r:e+r},""),Y=a.useMemo(()=>x&&c?c({...d,color:g}):(0,n.jsxs)("div",{className:`${b}-cntent`,style:{borderColor:g},children:[(0,n.jsx)("div",{className:`${b}-title`,children:null==d?void 0:d.title}),(0,n.jsx)("div",{className:`${b}-time`,children:M})]}),[d,g,x,c]);return(0,n.jsxs)("div",{className:(0,o.W)(b,r),style:{...l,top:m,zIndex:u?50:void 0},ref:t,...f,children:[(0,n.jsx)("div",{className:`${b}-line`,style:{backgroundColor:s||u?g:void 0,top:-m,height:m}}),Y]})});x.displayName="TimeCard";var k=r(9108);let M=(0,r(7977).Z)();function Y(e){let{timeRange:t,children:r}=e,[l,s]=a.useState(0),{getPrefixCls:d,rootElement:u}=a.useContext(y),m=d("timeline-axis"),c=a.useCallback(()=>{let e=[];if(!t)return e;let{step:r,scale:n}=f[l];for(let a=t.start;a.isBefore(t.end);a=a.add(r,n))e.push({time:a});return e},[t])(),p=(0,k.MG)({horizontal:!0,count:c.length,getScrollElement:()=>u,estimateSize:()=>1,gap:8,paddingStart:h.paddingStart,paddingEnd:h.paddingEnd}),v=e=>{p.scrollToOffset(p.scrollOffset+e.dx)};return a.useEffect(()=>(M.on("panmove",v),()=>{M.off("panmove",v)}),[]),(0,n.jsxs)("div",{className:m,style:{width:`${p.getTotalSize()}px`},children:[p.getVirtualItems().map(e=>{let{index:t,key:r}=e,{time:a}=c[t],{labelStep:s,majorLabelFormat:d,minorLabelFormat:u}=f[l],h=i()(a).format(d),v=i()(a).format(u),b=t%s==0;return(0,n.jsx)("div",{className:(0,o.W)(`${m}-tick`,{[`${m}-tick-major`]:b,[`${m}-tick-big-major`]:0===t}),"data-index":t,ref:p.measureElement,style:{transform:`translateX(${e.start}px)`},children:b&&(0,n.jsx)("div",{className:`${m}-tick-lable`,children:0===t?h:v})},r)}),r]})}r(7045);let C=(0,r(4706).H)(function(e){let{color:t,opacity:r=.3}=e;if(!t)return;if("number"!=typeof r||r<0||r>1)throw Error("透明度必须是0到1之间的数字");let n=document.createElement("div");n.style.display="none",n.style.color=t,document.body.appendChild(n);let a=getComputedStyle(n).color;document.body.removeChild(n);let l=a.match(/^rgb(a)?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/);if(l){let[,,e,t,n]=l;return`rgba(${e}, ${t}, ${n}, ${r})`}},{getCacheKey:e=>e.color+e.opacity});function j(e){let{className:t,style:r,data:l,checked:s,hover:d,...u}=e,{getPrefixCls:m,defaultColor:c}=a.useContext(y),f=m("timeline-point"),{time:h,color:v=c}=l;return Array.isArray(h)&&2===h.length?(0,n.jsxs)("div",{className:(0,o.W)(f,`${f}-range`,t),style:{...r,backgroundColor:d||s?C({color:v}):void 0},...u,children:[(0,n.jsx)("div",{className:`${f}-dot`,title:i()(h[0]).format(p),style:{backgroundColor:d||s?v:void 0}}),(0,n.jsx)("div",{className:`${f}-dot`,title:i()(h[1]).format(p),style:{backgroundColor:d||s?v:void 0}})]}):(0,n.jsx)("div",{className:(0,o.W)(f,`${f}-dot`,t),style:{...r,backgroundColor:d||s?v:void 0},title:i()(h).format(p)})}r(8955);let S=e=>Array.isArray(e)&&2===e.length;function w(e){let{start:t,end:r}=e,n=0===i()(r).minute()&&0===i()(r).second()&&0===i()(r).millisecond();return{start:i()(t).startOf("hour"),end:n?i()(r):i()(r).add(1,"hour").startOf("hour")}}let $=e=>{let{offsetWidth:t,offsetHeight:r}=e;return{width:t,height:r}},E=(e,t)=>{let r=e=>{let{width:t,height:r}=e;return{width:Math.round(t),height:Math.round(r)}};if(null==t?void 0:t.borderBoxSize){let e=t.borderBoxSize[0];if(e)return r({width:e.inlineSize,height:e.blockSize})}return r($(e))};function D(e){return Array.isArray(e)?e[0]:e}function L(e){let{className:t,style:r,data:l=[],moveable:u=!0,defaultColor:f=v,renderCard:p,onSelect:k}=e,C=e.prefixCls||c,L=a.useRef(null),F=a.useRef(null),[A]=a.useState(()=>new Map),[H]=a.useState(()=>new Map),N=a.useReducer(()=>({}),{})[1],[R,O]=a.useState(!1),[z,G]=a.useState(null),[I,W]=a.useState(null),[_,B]=a.useState(),T=a.useCallback(e=>g(e,C),[C]),X=T("timeline");function P(e){e.preventDefault()}a.useEffect(()=>{let e=L.current;if(!e)return;m()(e).styleCursor(!1).draggable({lockAxis:"x",inertia:!0,listeners:{start(e){u&&M.emit("panstart",e)},move(e){u&&M.emit("panmove",e)},end(e){u&&M.emit("panend",e)}}}).on("mousedown",function(){O(!0)}).on("mouseup",function(){O(!1)});let t="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";return e.addEventListener(t,P,!1),()=>{m()(e).unset(),e.removeEventListener(t,P,!1)}},[]),a.useEffect(()=>{B(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{padding:r=30,minRange:n=1440,defaultCenter:a=i()()}=t,l=i()(a),o={start:l.subtract(n/2,"minute"),end:l.add(n/2,"minute")};if(!e||0===e.length)return w(o);let s=e.flatMap(e=>S(e.time)?[i()(e.time[0]),i()(e.time[1])]:[i()(e.time)]);if(1===s.length){let e=i()(s[0]);return w({start:e.subtract(n/2,"minute"),end:e.add(n/2,"minute")})}let d=i()(Math.min(...s.map(e=>e.valueOf()))),u=i()(Math.max(...s.map(e=>e.valueOf()))),m=d.subtract(r,"minute"),c=u.add(r,"minute"),f=c.diff(m,"minute");if(f<n){let e=(n-f)/2;return w({start:m.subtract(e,"minute"),end:c.add(e,"minute")})}return w({start:m,end:c})}(l,{padding:30,minRange:1440,defaultCenter:new Date}))},[l]);let q=e=>{G(e)},K=e=>{if((null==I?void 0:I.id)===e.id){W(null),null==k||k(null);return}W(e),null==k||k(e)},V=(()=>{let e=null,t=()=>e||(window.ResizeObserver?e=new window.ResizeObserver(e=>{e.forEach(e=>{requestAnimationFrame(()=>{Z(e.target,e)})})}):null);return{disconnect:()=>{var r;null==(r=t())||r.disconnect(),e=null},observe:e=>{var r;return null==(r=t())?void 0:r.observe(e,{box:"border-box"})},unobserve:e=>{var r;return null==(r=t())?void 0:r.unobserve(e)}}})(),Z=(e,t)=>{let r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"data-key";return e.getAttribute(t)||""}(e),n=A.get(r);if(n!==e&&(n&&V.unobserve(n),V.observe(e),A.set(r,e)),e.isConnected){let n=E(e,t),a=e.getClientRects()[0],l=H.get(r),i={...n,key:r,x:a.x,y:a.y};if(!l){H.set(r,i),Q();return}(0,s.X)((0,d.C)(i,["x"]),(0,d.C)(l,["x"]))||(H.set(r,i),Q())}},J=a.useCallback(e=>{if(!e)return void A.forEach((e,t)=>{e.isConnected||(V.unobserve(e),A.delete(t))});Z(e,void 0)},[]),Q=()=>{let e=F.current;if(!e)return;let t=$(e).height,r=[];H.forEach(e=>{r.push(e)});let n=r.sort((e,t)=>i()(D(e.x)).isBefore(i()(D(t.x)))?-1:1),a=[];n.forEach((e,r)=>{let l=H.get(e.key),i=n.filter((e,t)=>{let n=H.get(e.key);return t<r&&function(e,t){let r=e.x,n=e.x+e.width,a=t.x;return r<t.x+t.width&&n>a}(l,n)});if(0===i.length)H.set(e.key,{...H.get(e.key),y:b.cardInitialGap}),a.push(l.height+b.cardInitialGap);else{let t=Math.max(...i.map(e=>n.findIndex(t=>t.key===e.key)).map(e=>a[e]||0));H.set(e.key,{...H.get(e.key),y:t}),a.push(t+e.height+b.cardGap)}H.get(e.key).y+e.height>t&&H.set(e.key,{...H.get(e.key),y:Math.max(0,t-e.height-b.cardGap)})}),N()};return(0,n.jsx)("div",{className:(0,o.W)(X,t),ref:L,style:{cursor:R?"grabbing":"grab",...r},children:(0,n.jsxs)(y.Provider,{value:{prefixCls:X,getPrefixCls:T,defaultColor:f,rootElement:L.current},children:[(0,n.jsx)(Y,{timeRange:_}),(0,n.jsx)("div",{className:`${X}-content`,ref:F,children:_&&l.map((e,t)=>{var r;let l,{time:o,id:s}=e,d=(null==(r=H.get(e.id))?void 0:r.y)||20,u=function(e){let{targetTime:t,baseTime:r,tickIntervalMs:n,tickWidth:a,tickGap:l,paddingStart:o,potSize:s}=e,d=i()(t).valueOf();return(d-i()(r).valueOf())/n*(a+l)+o-s/2}({targetTime:Array.isArray(o)?o[0]:o,baseTime:_.start,tickIntervalMs:6e4,tickWidth:h.width,tickGap:8,paddingStart:h.paddingStart,potSize:8});return Array.isArray(o)&&2===o.length&&(l=function(e){let{timeRange:t,tickIntervalMs:r,tickWidth:n,tickGap:a}=e,l=i()(t.start).valueOf();return(i()(t.end).valueOf()-l)/r*(n+a)+a}({timeRange:{start:o[0],end:o[1]},tickIntervalMs:6e4,tickWidth:h.width,tickGap:8})),(0,n.jsxs)(a.Fragment,{children:[(0,n.jsx)(j,{style:{transform:`translateX(${u}px)`,width:l?`${l}px`:void 0},data:e,hover:e.id===(null==z?void 0:z.id),checked:e.id===(null==I?void 0:I.id),onMouseEnter:()=>{q(e)},onMouseLeave:()=>{q(null)},onClick:()=>{K(e)}}),(0,n.jsx)(x,{style:{transform:`translateX(${u+4}px)`},position:d,ref:J,"data-key":e.id,hover:e.id===(null==z?void 0:z.id),checked:e.id===(null==I?void 0:I.id),data:e,onMouseEnter:()=>{q(e)},onMouseLeave:()=>{q(null)},onClick:()=>{K(e)},render:p})]},s||t)})})]})})}r(5924);let F=[{id:"1",title:"单点事件",color:"#A140E7",customRender:!1,time:"2024-03-10 10:00:00"},{id:"1111",title:"单点事件",time:"2024-03-10 10:01:00"},{id:"2",title:"时间范围事件",color:"#A140E7",customRender:!1,time:["2024-03-10 11:30:00","2024-03-10 13:30:00"]},{id:"3",title:"单点事件",customRender:!1,time:"2024-03-10 16:00:00"},{id:"4",title:"长时间范围事件",customRender:!1,time:["2024-03-10 14:15:00","2024-03-10 18:15:00"]},{id:"5",title:"长时间范围事件",customRender:!1,time:["2024-03-10 19:15:00","2024-03-10 23:15:00"]}],A=function(){return(0,n.jsx)(L,{data:F,renderCard:e=>(0,n.jsx)("div",{style:{background:"#fff",width:180,height:100,borderLeft:`3px solid ${e.color}`},children:e.title})})}}}]);