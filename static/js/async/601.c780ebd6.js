"use strict";(self.webpackChunk_pansy_react_timeline=self.webpackChunk_pansy_react_timeline||[]).push([["601"],{2220:function(e,t,r){r.r(t),r.d(t,{default:()=>E});var i=r(2676),l=r(5271),n=r(4461),a=r(1031),o=r(8605),s=r(4875),d=r.n(s);let u="pansy",m=[{scale:"minute",step:1,labelStep:10,majorLabelFormat:"YYYY-MM-DD",minorLabelFormat:"HH:mm:ss"},{scale:"minute",step:5,labelStep:10,majorLabelFormat:"YYYY-MM-DD",minorLabelFormat:"HH:mm:ss"},{scale:"minute",step:10,labelStep:10,majorLabelFormat:"YYYY-MM-DD",minorLabelFormat:"HH:mm:ss"},{scale:"minute",step:30,labelStep:10,majorLabelFormat:"YYYY-MM-DD",minorLabelFormat:"HH:mm:ss"},{scale:"hour",step:1,labelStep:5,majorLabelFormat:"YYYY-MM-DD",minorLabelFormat:"HH:mm"},{scale:"hour",step:6,labelStep:5,majorLabelFormat:"YYYY-MM-DD",minorLabelFormat:"HH:mm"},{scale:"hour",step:12,labelStep:5,majorLabelFormat:"YYYY-MM-DD",minorLabelFormat:"HH:mm"},{scale:"day",step:1,labelStep:1,majorLabelFormat:"YYYY-MM",minorLabelFormat:"DD"}],c={paddingStart:48,paddingEnd:48,width:1},f="YYYY-MM-DD HH:mm:ss",h="#2B6DE5",v={cardFirstRowMargin:24,cardRowGap:16};function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u;return e?`${t}-${e}`:t}let p=(0,r(7977).Z)();var b=r(6483),x=r.n(b);function y(e){let{start:t,end:r}=e,i=0===x()(r).minute()&&0===x()(r).second()&&0===x()(r).millisecond();return{start:x()(t).startOf("hour"),end:i?x()(r):x()(r).add(1,"hour").startOf("hour")}}let M=e=>{let{offsetWidth:t,offsetHeight:r}=e;return{width:t,height:r}},k=(e,t)=>{let r=e=>{let{width:t,height:r}=e;return{width:Math.round(t),height:Math.round(r)}};if(null==t?void 0:t.borderBoxSize){let e=t.borderBoxSize[0];if(e)return r({width:e.inlineSize,height:e.blockSize})}return r(M(e))},Y=l.createContext({prefixCls:u,defaultColor:h,getPrefixCls:g});var C=r(9108);function j(e){let{timeRange:t,children:r}=e,[a]=l.useState(0),{getPrefixCls:o,rootElement:s}=l.useContext(Y),d=o("timeline-axis"),u=l.useCallback(()=>{let e=[];if(!t)return e;let{step:r,scale:i}=m[a];for(let l=t.start;l.isBefore(t.end);l=l.add(r,i))e.push({time:l});return e},[t])(),f=(0,C.MG)({horizontal:!0,count:u.length,getScrollElement:()=>s,estimateSize:()=>1,gap:8,paddingStart:c.paddingStart,paddingEnd:c.paddingEnd}),h=e=>{f.scrollToOffset(f.scrollOffset+e.dx)};return l.useEffect(()=>(p.on("panmove",h),()=>{p.off("panmove",h)}),[]),(0,i.jsxs)("div",{className:d,style:{width:`${f.getTotalSize()}px`},children:[f.getVirtualItems().map(e=>{let{index:t,key:r}=e,{time:l}=u[t],{labelStep:o,majorLabelFormat:s,minorLabelFormat:c}=m[a],h=x()(l).format(s),v=x()(l).format(c),g=t%o==0;return(0,i.jsx)("div",{className:(0,n.W)(`${d}-tick`,{[`${d}-tick-major`]:g,[`${d}-tick-big-major`]:0===t}),"data-index":t,ref:f.measureElement,style:{transform:`translateX(${e.start}px)`},children:g&&(0,i.jsx)("div",{className:`${d}-tick-lable`,children:0===t?h:v})},r)}),r]})}r(7045),r(5411);let w=l.forwardRef(function(e,t){let{className:r,style:a,hover:o,data:s,checked:d,position:u=24,render:m,...c}=e,{getPrefixCls:h,defaultColor:v}=l.useContext(Y),g=h("timeline-card"),{color:p=v,customRender:b=!0,time:y}=s,M=(!y?[]:Array.isArray(y)?y:[y]).reduce((e,t)=>{let r=x()(t).format(f);return e?`${e} ~ ${r}`:e+r},""),k=l.useMemo(()=>b&&m?m({...s,color:p}):(0,i.jsxs)("div",{className:`${g}-cntent`,style:{borderColor:p},children:[(0,i.jsx)("div",{className:`${g}-title`,children:null==s?void 0:s.title}),(0,i.jsx)("div",{className:`${g}-time`,children:M})]}),[s,p,b,m]);return(0,i.jsxs)("div",{className:(0,n.W)(g,r),style:{...a,top:u},ref:t,...c,children:[(0,i.jsx)("div",{className:`${g}-line`,style:{backgroundColor:o||d?p:void 0,top:-u,height:u}}),(0,i.jsx)("div",{className:`${g}-container`,style:{zIndex:d?50:10},children:k})]})});w.displayName="TimeCard";let S=(0,r(4706).H)(function(e){let{color:t,opacity:r=.3}=e;if(!t)return;if("number"!=typeof r||r<0||r>1)throw Error("透明度必须是0到1之间的数字");let i=document.createElement("div");i.style.display="none",i.style.color=t,document.body.appendChild(i);let l=getComputedStyle(i).color;document.body.removeChild(i);let n=l.match(/^rgb(a)?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/);if(n){let[,,e,t,i]=n;return`rgba(${e}, ${t}, ${i}, ${r})`}},{getCacheKey:e=>e.color+e.opacity});function L(e){let{className:t,style:r,data:a,checked:o,hover:s,...d}=e,{getPrefixCls:u,defaultColor:m}=l.useContext(Y),c=u("timeline-point"),{time:h,color:v=m}=a;return Array.isArray(h)&&2===h.length?(0,i.jsxs)("div",{className:(0,n.W)(c,`${c}-range`,t),style:{...r,backgroundColor:s||o?S({color:v}):void 0},...d,children:[(0,i.jsx)("div",{className:`${c}-dot`,title:x()(h[0]).format(f),style:{backgroundColor:s||o?v:void 0}}),(0,i.jsx)("div",{className:`${c}-dot`,title:x()(h[1]).format(f),style:{backgroundColor:s||o?v:void 0}})]}):(0,i.jsx)("div",{className:(0,n.W)(c,`${c}-dot`,t),style:{...r,backgroundColor:s||o?v:void 0},title:x()(h).format(f)})}function $(e){let{className:t,style:r,data:s=[],moveable:m=!0,defaultColor:f=h,renderCard:b,onSelect:C}=e,S=e.prefixCls||u,$=l.useRef(null),R=l.useRef(null),[E]=l.useState(()=>new Map),[D]=l.useState(()=>new Map),F=l.useReducer(()=>({}),{})[1],[H,A]=l.useState(!1),[N,O]=l.useState(null),[z,W]=l.useState(null),[_,T]=l.useState(),B=l.useCallback(e=>g(e,S),[S]),G=B("timeline");function I(e){e.preventDefault()}l.useEffect(()=>{let e=$.current;if(!e)return;d()(e).styleCursor(!1).draggable({lockAxis:"x",inertia:!0,listeners:{start(e){m&&p.emit("panstart",e)},move(e){m&&p.emit("panmove",e)},end(e){m&&p.emit("panend",e)}}}).on("mousedown",()=>{A(!0)}).on("mouseup",()=>{A(!1)});let t="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";return e.addEventListener(t,I,!1),()=>{d()(e).unset(),e.removeEventListener(t,I,!1)}},[]),l.useEffect(()=>{T(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{padding:r=30,minRange:i=1440,defaultCenter:l=x()()}=t,n=x()(l),a={start:n.subtract(i/2,"minute"),end:n.add(i/2,"minute")};if(!e||0===e.length)return y(a);let o=e.flatMap(e=>{var t;return Array.isArray(t=e.time)&&2===t.length?[x()(e.time[0]),x()(e.time[1])]:[x()(e.time)]});if(1===o.length){let e=x()(o[0]);return y({start:e.subtract(i/2,"minute"),end:e.add(i/2,"minute")})}let s=x()(Math.min(...o.map(e=>e.valueOf()))),d=x()(Math.max(...o.map(e=>e.valueOf()))),u=s.subtract(r,"minute"),m=d.add(r,"minute"),c=m.diff(u,"minute");if(c<i){let e=(i-c)/2;return y({start:u.subtract(e,"minute"),end:m.add(e,"minute")})}return y({start:u,end:m})}(s,{padding:30,minRange:1440,defaultCenter:new Date}))},[s]);let X=e=>{O(e)},P=e=>{if((null==z?void 0:z.id)===e.id){W(null),null==C||C(null);return}W(e),null==C||C(e)},q=(()=>{let e=null,t=()=>e||(window.ResizeObserver?e=new window.ResizeObserver(e=>{e.forEach(e=>{requestAnimationFrame(()=>{V(e.target,e)})})}):null);return{disconnect:()=>{var r;null==(r=t())||r.disconnect(),e=null},observe:e=>{var r;return null==(r=t())?void 0:r.observe(e,{box:"border-box"})},unobserve:e=>{var r;return null==(r=t())?void 0:r.unobserve(e)}}})(),K=()=>{let e=R.current;if(!e)return;let t=M(e).height;t<=v.cardFirstRowMargin||((function(e){if(e.length<2)return[];let t=[...e].sort((e,t)=>e.x-t.x),r=[];for(let e of t){let t=e.x+e.width,i=[];for(let l of r)e.x<l.maxRight&&t>l.minLeft&&i.push(l);if(i.length>0){let l=i[0];l.items.push(e),l.minLeft=Math.min(l.minLeft,e.x),l.maxRight=Math.max(l.maxRight,t);for(let e=1;e<i.length;e++){let t=i[e];l.items.push(...t.items),l.minLeft=Math.min(l.minLeft,t.minLeft),l.maxRight=Math.max(l.maxRight,t.maxRight);let n=r.indexOf(t);-1!==n&&r.splice(n,1)}}else r.push({items:[e],minLeft:e.x,maxRight:t})}return r.map(e=>e.items).filter(e=>e.length>=2)})(Array.from(D.values())).forEach(e=>{let{cardFirstRowMargin:r,cardRowGap:i}=v,l=r,n=1;e.forEach(e=>{if(1===n){let a=l+e.height+i;a<=t?(D.set(e.key,{...D.get(e.key),y:l}),l=a):(n=-1,l=t-r-e.height,D.set(e.key,{...D.get(e.key),y:l}))}else{let t=l-e.height-i;t>=r?l=t:(n=1,l=r),D.set(e.key,{...D.get(e.key),y:l})}})}),F())},V=(e,t)=>{let r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"data-key";return e.getAttribute(t)||""}(e),i=E.get(r);if(i!==e&&(i&&q.unobserve(i),q.observe(e),E.set(r,e)),e.isConnected){let i=k(e,t),n=e.getClientRects()[0],s=D.get(r),d={...i,key:r,x:n.x,y:v.cardFirstRowMargin};if(!s){D.set(r,d),K();return}if(!(0,a.X)((0,o.C)(d,["y"]),(0,o.C)(s,["y"]))){var l;D.set(r,{...d,y:(null==(l=D.get(r))?void 0:l.y)||v.cardFirstRowMargin}),K()}}},Z=l.useCallback(e=>{if(!e)return void E.forEach((e,t)=>{e.isConnected||(q.unobserve(e),E.delete(t))});V(e,void 0)},[]);return(0,i.jsx)("div",{className:(0,n.W)(G,t),ref:$,style:{cursor:H?"grabbing":"grab",...r},children:(0,i.jsxs)(Y.Provider,{value:{prefixCls:G,getPrefixCls:B,defaultColor:f,rootElement:$.current},children:[(0,i.jsx)(j,{timeRange:_}),(0,i.jsx)("div",{className:`${G}-content`,ref:R,children:_&&s.map((e,t)=>{var r;let n,{time:a,id:o}=e,s=(null==(r=D.get(e.id))?void 0:r.y)||20,d=function(e){let{targetTime:t,baseTime:r,tickIntervalMs:i,tickWidth:l,tickGap:n,paddingStart:a,potSize:o}=e,s=x()(t).valueOf();return(s-x()(r).valueOf())/i*(l+n)+a-o/2}({targetTime:Array.isArray(a)?a[0]:a,baseTime:_.start,tickIntervalMs:6e4,tickWidth:c.width,tickGap:8,paddingStart:c.paddingStart,potSize:8});return Array.isArray(a)&&2===a.length&&(n=function(e){let{timeRange:t,tickIntervalMs:r,tickWidth:i,tickGap:l}=e,n=x()(t.start).valueOf();return(x()(t.end).valueOf()-n)/r*(i+l)+l}({timeRange:{start:a[0],end:a[1]},tickIntervalMs:6e4,tickWidth:c.width,tickGap:8})),(0,i.jsxs)(l.Fragment,{children:[(0,i.jsx)(L,{style:{transform:`translateX(${d}px)`,width:n?`${n}px`:void 0},data:e,hover:e.id===(null==N?void 0:N.id),checked:e.id===(null==z?void 0:z.id),onMouseEnter:()=>{X(e)},onMouseLeave:()=>{X(null)},onClick:()=>{P(e)}}),(0,i.jsx)(w,{style:{left:d+4},position:s,ref:Z,"data-key":e.id,hover:e.id===(null==N?void 0:N.id),checked:e.id===(null==z?void 0:z.id),data:e,onMouseEnter:()=>{X(e)},onMouseLeave:()=>{X(null)},onClick:()=>{P(e)},render:b})]},o||t)})})]})})}r(8955),r(5924);let R=[{id:"1",title:"单点事件",color:"#A140E7",customRender:!1,time:"2024-03-10 10:00:00"},{id:"1111",title:"单点事件",time:"2024-03-10 10:01:00"},{id:"2",title:"时间范围事件",color:"#A140E7",customRender:!1,time:["2024-03-10 11:30:00","2024-03-10 13:30:00"]},{id:"3",title:"单点事件",customRender:!1,time:"2024-03-10 16:00:00"},{id:"4",title:"长时间范围事件",customRender:!1,time:["2024-03-10 14:15:00","2024-03-10 18:15:00"]},{id:"5",title:"长时间范围事件",customRender:!1,time:["2024-03-10 19:15:00","2024-03-10 23:15:00"]}],E=function(){return(0,i.jsx)($,{data:R,renderCard:e=>(0,i.jsx)("div",{style:{background:"#fff",width:180,height:100,borderLeft:`3px solid ${e.color}`},children:e.title})})}}}]);