"use strict";(self.webpackChunk_pansy_react_timeline=self.webpackChunk_pansy_react_timeline||[]).push([["601"],{2220:function(e,t,r){r.r(t),r.d(t,{default:()=>D});var n=r(2676),i=r(5271),l=r(4461),a=r(1031),o=r(8605),s=r(4875),d=r.n(s);let u="pansy",m=[{scale:"minute",step:1,labelStep:10,majorLabelFormat:"YYYY-MM-DD",minorLabelFormat:"HH:mm:ss"},{scale:"minute",step:5,labelStep:10,majorLabelFormat:"YYYY-MM-DD",minorLabelFormat:"HH:mm:ss"},{scale:"minute",step:10,labelStep:10,majorLabelFormat:"YYYY-MM-DD",minorLabelFormat:"HH:mm:ss"},{scale:"minute",step:30,labelStep:10,majorLabelFormat:"YYYY-MM-DD",minorLabelFormat:"HH:mm:ss"},{scale:"hour",step:1,labelStep:5,majorLabelFormat:"YYYY-MM-DD",minorLabelFormat:"HH:mm"},{scale:"hour",step:6,labelStep:5,majorLabelFormat:"YYYY-MM-DD",minorLabelFormat:"HH:mm"},{scale:"hour",step:12,labelStep:5,majorLabelFormat:"YYYY-MM-DD",minorLabelFormat:"HH:mm"},{scale:"day",step:1,labelStep:1,majorLabelFormat:"YYYY-MM",minorLabelFormat:"DD"}],c={paddingStart:48,paddingEnd:48,width:1},f="YYYY-MM-DD HH:mm:ss",h="#2B6DE5",v={cardFirstRowMargin:24,cardRowGap:16};var g=r(6483),p=r.n(g);function b(e){let{start:t,end:r}=e,n=0===p()(r).minute()&&0===p()(r).second()&&0===p()(r).millisecond();return{start:p()(t).startOf("hour"),end:n?p()(r):p()(r).add(1,"hour").startOf("hour")}}function x(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u;return e?`${t}-${e}`:t}let y=(0,r(7977).Z)();function M(e){let{offsetWidth:t,offsetHeight:r}=e;return{width:t,height:r}}let k=i.createContext({prefixCls:u,defaultColor:h,getPrefixCls:x});var Y=r(9108);function C(e){let{timeRange:t,children:r}=e,[a]=i.useState(0),{getPrefixCls:o,rootElement:s}=i.useContext(k),d=o("timeline-axis"),u=i.useCallback(()=>{let e=[];if(!t)return e;let{step:r,scale:n}=m[a];for(let i=t.start;i.isBefore(t.end);i=i.add(r,n))e.push({time:i});return e},[t])(),f=(0,Y.MG)({horizontal:!0,count:u.length,getScrollElement:()=>s,estimateSize:()=>1,gap:8,paddingStart:c.paddingStart,paddingEnd:c.paddingEnd}),h=e=>{f.scrollToOffset(f.scrollOffset+e.dx)};return i.useEffect(()=>(y.on("panmove",h),()=>{y.off("panmove",h)}),[]),(0,n.jsxs)("div",{className:d,style:{width:`${f.getTotalSize()}px`},children:[f.getVirtualItems().map(e=>{let{index:t,key:r}=e,{time:i}=u[t],{labelStep:o,majorLabelFormat:s,minorLabelFormat:c}=m[a],h=p()(i).format(s),v=p()(i).format(c),g=t%o==0;return(0,n.jsx)("div",{className:(0,l.W)(`${d}-tick`,{[`${d}-tick-major`]:g,[`${d}-tick-big-major`]:0===t}),"data-index":t,ref:f.measureElement,style:{transform:`translateX(${e.start}px)`},children:g&&(0,n.jsx)("div",{className:`${d}-tick-lable`,children:0===t?h:v})},r)}),r]})}r(7045),r(5411);let j=i.forwardRef(function(e,t){let{className:r,style:a,hover:o,data:s,checked:d,position:u=24,render:m,...c}=e,{getPrefixCls:h,defaultColor:v}=i.useContext(k),g=h("timeline-card"),{color:b=v,customRender:x=!0,time:y}=s,M=(!y?[]:Array.isArray(y)?y:[y]).reduce((e,t)=>{let r=p()(t).format(f);return e?`${e} ~ ${r}`:e+r},""),Y=i.useMemo(()=>x&&m?m({...s,color:b}):(0,n.jsxs)("div",{className:`${g}-cntent`,style:{borderColor:b},children:[(0,n.jsx)("div",{className:`${g}-title`,children:null==s?void 0:s.title}),(0,n.jsx)("div",{className:`${g}-time`,children:M})]}),[s,b,x,m]);return(0,n.jsxs)("div",{className:(0,l.W)(g,r),style:{...a,top:u},ref:t,...c,children:[(0,n.jsx)("div",{className:`${g}-line`,style:{backgroundColor:o||d?b:void 0,top:-u,height:u}}),(0,n.jsx)("div",{className:`${g}-container`,style:{zIndex:d?50:10},children:Y})]})});j.displayName="TimeCard";let w=(0,r(4706).H)(function(e){let{color:t,opacity:r=.3}=e;if(!t)return;if("number"!=typeof r||r<0||r>1)throw Error("透明度必须是0到1之间的数字");let n=document.createElement("div");n.style.display="none",n.style.color=t,document.body.appendChild(n);let i=getComputedStyle(n).color;document.body.removeChild(n);let l=i.match(/^rgb(a)?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/);if(l){let[,,e,t,n]=l;return`rgba(${e}, ${t}, ${n}, ${r})`}},{getCacheKey:e=>e.color+e.opacity});function S(e){let{className:t,style:r,data:a,checked:o,hover:s,...d}=e,{getPrefixCls:u,defaultColor:m}=i.useContext(k),c=u("timeline-point"),{time:h,color:v=m}=a;return Array.isArray(h)&&2===h.length?(0,n.jsxs)("div",{className:(0,l.W)(c,`${c}-range`,t),style:{...r,backgroundColor:s||o?w({color:v}):void 0},...d,children:[(0,n.jsx)("div",{className:`${c}-dot`,title:p()(h[0]).format(f),style:{backgroundColor:s||o?v:void 0}}),(0,n.jsx)("div",{className:`${c}-dot`,title:p()(h[1]).format(f),style:{backgroundColor:s||o?v:void 0}})]}):(0,n.jsx)("div",{className:(0,l.W)(c,`${c}-dot`,t),style:{...r,backgroundColor:s||o?v:void 0},title:p()(h).format(f)})}r(8955),r(5924);let L=[];function $(e){let{className:t,style:r,data:s=L,moveable:m=!0,defaultColor:f=h,renderCard:g,onSelect:Y}=e,w=e.prefixCls||u,$=i.useRef(null),R=i.useRef(null),[D]=i.useState(()=>new Map),[E]=i.useState(()=>new Map),F=i.useReducer(()=>({}),{})[1],[H,A]=i.useState(!1),[N,O]=i.useState(null),[z,W]=i.useState(null),_=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{padding:r=30,minRange:n=1440,defaultCenter:i=p()()}=t,l=p()(i),a={start:l.subtract(n/2,"minute"),end:l.add(n/2,"minute")};if(!e||0===e.length)return b(a);let o=e.flatMap(e=>{var t;return Array.isArray(t=e.time)&&2===t.length?[p()(e.time[0]),p()(e.time[1])]:[p()(e.time)]});if(1===o.length){let e=p()(o[0]);return b({start:e.subtract(n/2,"minute"),end:e.add(n/2,"minute")})}let s=p()(Math.min(...o.map(e=>e.valueOf()))),d=p()(Math.max(...o.map(e=>e.valueOf()))),u=s.subtract(r,"minute"),m=d.add(r,"minute"),c=m.diff(u,"minute");if(c<n){let e=(n-c)/2;return b({start:u.subtract(e,"minute"),end:m.add(e,"minute")})}return b({start:u,end:m})}(s,{padding:30,minRange:1440,defaultCenter:new Date}),T=i.useCallback(e=>x(e,w),[w]),B=T("timeline");function G(e){e.preventDefault()}i.useEffect(()=>{let e=$.current;if(!e)return;d()(e).styleCursor(!1).draggable({lockAxis:"x",inertia:!0,listeners:{start(e){m&&y.emit("panstart",e)},move(e){m&&y.emit("panmove",e)},end(e){m&&y.emit("panend",e)}}}).on("mousedown",()=>{A(!0)}).on("mouseup",()=>{A(!1)});let t="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";return e.addEventListener(t,G,!1),()=>{d()(e).unset(),e.removeEventListener(t,G,!1)}},[]);let I=e=>{O(e)},X=e=>{if((null==z?void 0:z.id)===e.id){W(null),null==Y||Y(null);return}W(e),null==Y||Y(e)},P=(()=>{let e=null,t=()=>e||(window.ResizeObserver?e=new window.ResizeObserver(e=>{e.forEach(e=>{requestAnimationFrame(()=>{K(e.target,e)})})}):null);return{disconnect:()=>{var r;null==(r=t())||r.disconnect(),e=null},observe:e=>{var r;return null==(r=t())?void 0:r.observe(e,{box:"border-box"})},unobserve:e=>{var r;return null==(r=t())?void 0:r.unobserve(e)}}})(),q=()=>{let e=R.current;if(!e)return;let t=M(e).height;t<=v.cardFirstRowMargin||((function(e){if(e.length<2)return[];let t=[...e].sort((e,t)=>e.x-t.x),r=[];for(let e of t){let t=e.x+e.width,n=[];for(let i of r)e.x<i.maxRight&&t>i.minLeft&&n.push(i);if(n.length>0){let i=n[0];i.items.push(e),i.minLeft=Math.min(i.minLeft,e.x),i.maxRight=Math.max(i.maxRight,t);for(let e=1;e<n.length;e++){let t=n[e];i.items.push(...t.items),i.minLeft=Math.min(i.minLeft,t.minLeft),i.maxRight=Math.max(i.maxRight,t.maxRight);let l=r.indexOf(t);-1!==l&&r.splice(l,1)}}else r.push({items:[e],minLeft:e.x,maxRight:t})}return r.map(e=>e.items).filter(e=>e.length>=2)})(Array.from(E.values())).forEach(e=>{let{cardFirstRowMargin:r,cardRowGap:n}=v,i=r,l=1;e.forEach(e=>{if(1===l){let a=i+e.height+n;a<=t?(E.set(e.key,{...E.get(e.key),y:i}),i=a):(l=-1,i=t-r-e.height,E.set(e.key,{...E.get(e.key),y:i}))}else{let t=i-e.height-n;t>=r?i=t:(l=1,i=r),E.set(e.key,{...E.get(e.key),y:i})}})}),F())},K=(e,t)=>{let r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"data-key";return e.getAttribute(t)||""}(e),n=D.get(r);if(n!==e&&(n&&P.unobserve(n),P.observe(e),D.set(r,e)),e.isConnected){let n=function(e,t){let r=e=>{let{width:t,height:r}=e;return{width:Math.round(t),height:Math.round(r)}};if(null==t?void 0:t.borderBoxSize){let e=t.borderBoxSize[0];if(e)return r({width:e.inlineSize,height:e.blockSize})}return r(M(e))}(e,t),l=e.getClientRects()[0],s=E.get(r),d={...n,key:r,x:l.x,y:v.cardFirstRowMargin};if(!s){E.set(r,d),q();return}if(!(0,a.X)((0,o.C)(d,["y"]),(0,o.C)(s,["y"]))){var i;E.set(r,{...d,y:(null==(i=E.get(r))?void 0:i.y)||v.cardFirstRowMargin}),q()}}},V=i.useCallback(e=>{if(!e)return void D.forEach((e,t)=>{e.isConnected||(P.unobserve(e),D.delete(t))});K(e,void 0)},[]),Z=i.useMemo(()=>({prefixCls:B,getPrefixCls:T,defaultColor:f,rootElement:$.current}),[B,T,f]);return(0,n.jsx)("div",{className:(0,l.W)(B,t),ref:$,style:{cursor:H?"grabbing":"grab",...r},children:(0,n.jsxs)(k.Provider,{value:Z,children:[(0,n.jsx)(C,{timeRange:_}),(0,n.jsx)("div",{className:`${B}-content`,ref:R,children:_&&s.map((e,t)=>{var r;let l,{time:a,id:o}=e,s=(null==(r=E.get(e.id))?void 0:r.y)||20,d=function(e){let{targetTime:t,baseTime:r,tickIntervalMs:n,tickWidth:i,tickGap:l,paddingStart:a,potSize:o}=e,s=p()(t).valueOf();return(s-p()(r).valueOf())/n*(i+l)+a-o/2}({targetTime:Array.isArray(a)?a[0]:a,baseTime:_.start,tickIntervalMs:6e4,tickWidth:c.width,tickGap:8,paddingStart:c.paddingStart,potSize:8});return Array.isArray(a)&&2===a.length&&(l=function(e){let{timeRange:t,tickIntervalMs:r,tickWidth:n,tickGap:i}=e,l=p()(t.start).valueOf();return(p()(t.end).valueOf()-l)/r*(n+i)+i}({timeRange:{start:a[0],end:a[1]},tickIntervalMs:6e4,tickWidth:c.width,tickGap:8})),(0,n.jsxs)(i.Fragment,{children:[(0,n.jsx)(S,{style:{transform:`translateX(${d}px)`,width:l?`${l}px`:void 0},data:e,hover:e.id===(null==N?void 0:N.id),checked:e.id===(null==z?void 0:z.id),onMouseEnter:()=>{I(e)},onMouseLeave:()=>{I(null)},onClick:()=>{X(e)}}),(0,n.jsx)(j,{style:{left:d+4},position:s,ref:V,"data-key":e.id,hover:e.id===(null==N?void 0:N.id),checked:e.id===(null==z?void 0:z.id),data:e,onMouseEnter:()=>{I(e)},onMouseLeave:()=>{I(null)},onClick:()=>{X(e)},render:g})]},o||t)})})]})})}let R=[{id:"1",title:"单点事件",color:"#A140E7",customRender:!1,time:"2024-03-10 10:00:00"},{id:"1111",title:"单点事件",time:"2024-03-10 10:01:00"},{id:"2",title:"时间范围事件",color:"#A140E7",customRender:!1,time:["2024-03-10 11:30:00","2024-03-10 13:30:00"]},{id:"3",title:"单点事件",customRender:!1,time:"2024-03-10 16:00:00"},{id:"4",title:"长时间范围事件",customRender:!1,time:["2024-03-10 14:15:00","2024-03-10 18:15:00"]},{id:"5",title:"长时间范围事件",customRender:!1,time:["2024-03-10 19:15:00","2024-03-10 23:15:00"]}],D=function(){return(0,n.jsx)($,{data:R,renderCard:e=>(0,n.jsx)("div",{style:{background:"#fff",width:180,height:100,borderLeft:`3px solid ${e.color}`},children:e.title})})}}}]);